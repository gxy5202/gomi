---
layout: '../../layouts/BlogLayout.astro'
tags: [tech]
title: Dokployéƒ¨ç½²å®è·µæ€»ç»“
publishDate: 2025-05-22
cover: "../../assets/images/content-more/content-23.png"
author: "Gomi"
name: "content-23"
---
## ç®€ä»‹

[Dokploy](https://dokploy.com/)æ˜¯ä¸€ä¸ªå¼€æºçš„ä¸€ç«™å¼éƒ¨ç½²å¹³å°ï¼Œæ˜¯Vercelå’ŒNetlifyçš„æ›¿ä»£å“ã€‚å› ä¸ºæˆ‘å¾ˆå¤šç½‘ç«™éƒ½æ˜¯éƒ¨ç½²åœ¨Netlifyä¸Šçš„ï¼Œæ‰€ä»¥å¯¹è¿™ç§åœ¨githubæäº¤åå°±èƒ½è‡ªåŠ¨éƒ¨ç½²çš„å¹³å°éå¸¸é’çï¼Œå› ä¸ºèƒ½çœéå¸¸å¤šçš„äº‹ï¼Œåˆèƒ½å®ç°å¾ˆå¤šè‡ªåŠ¨åŒ–çš„åŠŸèƒ½ã€‚


## éƒ¨ç½²é‡ç‚¹

### Webåº”ç”¨ç«¯å£å†²çª
éƒ¨ç½²çš„æ­¥éª¤éå¸¸ç®€å•ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£æ¥å°±èƒ½å®Œæˆã€‚è¿™é‡Œä¸»è¦è¯´ä¸€ä¸‹æ³¨æ„çš„åœ°æ–¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯dokployç®¡ç†ç«¯é»˜è®¤çš„ç«¯å£æ˜¯3000ï¼Œæ‰€ä»¥å¦‚æœä½ çš„ç½‘ç«™æ˜¯åŸºäºnodeçš„ï¼Œæ¯”å¦‚nextjsã€Astroç­‰æ¡†æ¶ï¼Œé»˜è®¤ç«¯å£éƒ½æ˜¯3000ï¼Œè¿™ä¼šå¯¼è‡´ç«¯å£å†²çªã€‚äºæ˜¯æˆ‘ä¿®æ”¹äº†æˆ‘è‡ªå·±é¡¹ç›®çš„ç«¯å£ï¼Œé€‰æ‹©ä¸æ”¹åŠ¨dokployçš„ç«¯å£ã€‚

### ç«¯å£é…ç½®
æ¯”å¦‚æˆ‘é¡¹ç›®çš„ç«¯å£æ”¹ä¸ºäº†3001ï¼Œä½†æ˜¯ç”±äºæœåŠ¡å™¨å¯¹å¤–æš´éœ²çš„ç«¯å£æ˜¯8080ï¼Œä»¥å‰æˆ‘æ˜¯é€šè¿‡nginxæ¥ä»£ç†è½¬å‘ã€‚ç°åœ¨éœ€è¦ä½¿ç”¨dokployçš„Traefikæ¥ä½œä¸ºä»£ç†ï¼Œç”±äºé»˜è®¤ä¹Ÿæ˜¯8080ç«¯å£ï¼Œæ‰€ä»¥å†Port Mappingsä¸­å°†ç«¯å£éƒ½è®¾ç½®ä¸º8080å³å¯ã€‚è¿™æ ·å°±ä¼šè‡ªå½“è½¬å‘åˆ°æˆ‘ä»¬éƒ¨ç½²çš„3001ç«¯å£ã€‚è¯¦ç»†å¯ä»¥æŸ¥çœ‹advancedä¸­çš„traefiké…ç½®æ˜¯å¦æ­£ç¡®
![image.png](../../assets/images/content-more/content-23-2.png)

### HTTPS
é€šè¿‡dokployé€‰æ‹©let's encryptåï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è‡ªå·±å»ç”Ÿæˆæˆ–è€…è´­ä¹°httpsè¯ä¹¦ã€‚

### ç¯å¢ƒå˜é‡
å…¶æ¬¡æ˜¯`.env.local`ç›¸å…³çš„é«˜æ•æ„Ÿé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚stripã€supbaseç­‰çš„tokenä¿¡æ¯ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸ä¼šæäº¤åˆ°ä»“åº“çš„ï¼Œæ‰€ä»¥å³ä½¿è‡ªåŠ¨éƒ¨ç½²åˆ°å¹³å°ä¸Šï¼Œä½ çš„é¡¹ç›®ä¹Ÿä¸ä¼šæœ‰ä½ é¡¹ç›®éœ€è¦çš„é…ç½®ä¿¡æ¯ã€‚è¿™æ—¶å€™å°±è¦ç”¨åˆ°dokployæä¾›çš„ç¯å¢ƒå˜é‡åŠŸèƒ½ï¼Œå®ƒçš„ä½œç”¨å’Œä½ é¡¹ç›®ä¸­çš„`.env.local`æ˜¯ç±»ä¼¼çš„ã€‚

### éƒ¨ç½²é”™è¯¯
è¿˜æœ‰å°±æ˜¯ç”±äºæ˜¯dockeréƒ¨ç½²ï¼Œåœ¨ä½ çš„é¡¹ç›®æ˜¯**monorepo**çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚pnpmçš„workspaceï¼Œå¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚ä½ éœ€è¦åœ¨é¡¹ç›®ç§æ·»åŠ `.dockerignore`æ–‡ä»¶æ¥å¿½ç•¥è°ƒä¸€äº›æ–‡ä»¶ï¼Œæ¯”å¦‚**node_modules**ã€‚

### ç£ç›˜ç›‘æ§
æœ€åå°±æ˜¯ç£ç›˜å ç”¨ï¼Œç”±äºdokployæ¯æ¬¡éƒ¨ç½²éƒ½ä¼šäº§ç”Ÿæ—¥å¿—ä¿¡æ¯ï¼Œè¿˜ä¼šæœ‰å¾ˆå¤šçš„dockeræœ¬èº«çš„å†—ä½™é•œåƒç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘çš„äº‘æœåŠ¡å™¨50Gçš„å¤§å°ï¼Œå†éƒ¨ç½²äº†æ¥è¿‘10æ­¤åï¼Œå°±å¿«å æ»¡äº†ã€‚
![image.png](../../assets/images/content-more/content-23-3.png)
è¿™æ—¶å€™åªæœ‰æ‰‹åŠ¨æ¸…é™¤æ—¥å¿—ã€é•œåƒç­‰å å†…å­˜çš„æ–‡ä»¶ã€‚è¿™æ—¶å€™dokployæä¾›çš„scheduleså°±èµ·ä½œç”¨äº†ï¼Œä½ å¯ä»¥å†™ä¸€æ®µæ¸…é™¤æ—¥å¿—å’Œé•œåƒçš„shellè„šæœ¬ï¼Œè®©å®ƒæ¯å¤©å®šæ—¶æ‰§è¡Œï¼Œå°±å¯ä»¥ä¿è¯ä½ çš„ç£ç›˜ä¸ä¼šè¢«å æ»¡äº†ï¼Œä¸‹é¢æ˜¯æˆ‘è®©AIå¸®æˆ‘å†™çš„è„šæœ¬ã€‚
![image.png](../../assets/images/content-more/content-23-1.png)
```shell
#!/bin/bash

LOG_FILE="/var/log/docker_prune.log"

echo "===== å¼€å§‹ Docker æ¸…ç† [$(date)] =====" | tee -a "$LOG_FILE"
docker system prune -af --volumes | tee -a "$LOG_FILE"
echo "===== æ¸…ç†å®Œæˆ [$(date)] =====" | tee -a "$LOG_FILE"

# Docker æ—¥å¿—ç›®å½•ï¼ˆé»˜è®¤ï¼‰
LOG_DIR="/var/lib/docker/containers"
MAX_SIZE_MB=1     # è®¾ç½®ä¸º 0 è¡¨ç¤ºæ¸…ç†å…¨éƒ¨
ARCHIVE=false      # true è¡¨ç¤ºå‹ç¼©å¤‡ä»½æ—¥å¿—ï¼Œfalse è¡¨ç¤ºç›´æ¥æ¸…ç©º

echo "ğŸ§¹ Docker æ—¥å¿—æ¸…ç†å¼€å§‹..."
echo "æ¸…ç†æ—¥å¿—å¤§äº ${MAX_SIZE_MB}MB çš„æ–‡ä»¶..."

# éå†å¹¶æ¸…ç†æ—¥å¿—
find "$LOG_DIR" -type f -name "*-json.log" | while read -r log_file; do
    size_bytes=$(stat -c %s "$log_file")
    size_mb=$((size_bytes / 1024 / 1024))

    if [ "$MAX_SIZE_MB" -eq 0 ] || [ "$size_mb" -ge "$MAX_SIZE_MB" ]; then
        echo "ğŸ—‘ï¸ æ¸…ç†: $log_file (${size_mb}MB)"
        if [ "$ARCHIVE" = true ]; then
            gzip "$log_file"
        else
            cat /dev/null > "$log_file"
        fi
    else
        echo "âœ… ä¿ç•™: $log_file (${size_mb}MB)"
    fi
done

echo "âœ… Docker æ—¥å¿—æ¸…ç†å®Œæˆ"

```



